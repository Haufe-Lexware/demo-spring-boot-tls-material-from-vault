description = 'Spring TLS configuration based on key material obtained from vault'

dependencies {
    compile("org.springframework.boot:spring-boot-starter-web:${springBootVersion}")
    compile "org.slf4j:slf4j-api"

    compile("com.google.guava:guava:${guavaVersion}")
    compile "com.diffplug.durian:durian:${durianVersion}"
    compile "io.javaslang:javaslang:${javaslangVersion}"
    compile "org.apache.commons:commons-lang3:${apacheCommonsLang3Version}"

    compile('org.springframework.cloud:spring-cloud-starter-vault-config')
    compile('org.springframework.cloud:spring-cloud-config-client')

    compileOnly("org.immutables:value:${immutableValuesVersion}")
    compileOnly "org.projectlombok:lombok:${lombokVersion}"
    compileOnly "org.springframework.boot:spring-boot-configuration-processor"
}

// needed by lombok
compileJava.dependsOn(processResources)

ext {
    generatedSourcesDir = file('src/main/generated')
}

sourceSets {
    // configure a source dir for the IDE, so it has safe place for the APT generated sources
    main {
        java {
            srcDir "${generatedSourcesDir.path}"
            // exclude these generated files from compilation as gradle's APT will generate into build/generated/...
            // without this there will be "duplicate class" errors
            exclude '**/spring/cloud/vault/config/tls/Immutable*.java'
        }
    }
}

idea.module {
    generatedSourceDirs += generatedSourcesDir
}

clean {
    delete generatedSourcesDir
}
